<!-- -->
<launch>
    <!-- For ref: https://docs.omniverse.nvidia.com/app_isaacsim/app_isaacsim/tutorial_ros_navigation.html#isaac-sim-app-tutorial-ros-navigation

         1) In Isaac sim, click on menu Isaac Examples - ROS - Navigation
         2) Terminal:  $ roscore
         3) To teleop: $ rosrun teleop_twist_keyboard teleop_twist_keyboard.py _speed:=0.15 _turn:=0.20
         4) Navigation: roslaunch rtabmap_ros demo_isaac_carter_navigation.launch
         5) Set max depth range to 10m in rtabmapviz for correct visualization (Preferences->3D Rendering under map and odom columns)
         6) Press Play in Isaac sim

         Note: carter_2dnav package can be copied to your catkin_ws from:
            $ cp -r ~/.local/share/ov/pkg/isaac_sim-2021.2.0/ros_workspace/src/* ~/catkin_ws/src/.
    -->

    <param name="use_sim_time" value="true" />
    <arg name="localization" default="false" />

    <!-- Load Robot Description -->
    <arg name="model" default="$(find carter_description)/urdf/carter.urdf"/>
    <param name="robot_description" textfile="$(arg model)" />

    <!-- RTAB-Map -->
    <remap from="/rtabmap/grid_map" to="/map"/>
    <include file="$(find rtabmap_ros)/launch/rtabmap.launch">
        <arg     if="$(arg localization)" name="args" value="--Reg/Strategy 1 --Reg/Force3DoF true --RGBD/NeighborLinkRefining true"/>
        <arg unless="$(arg localization)" name="args" value="-d --Reg/Strategy 1 --Reg/Force3DoF true --RGBD/NeighborLinkRefining true"/>
        <arg name="localization"      value="$(arg localization)"/>
        <arg name="subscribe_scan"    value="true"/>
        <arg name="visual_odometry"   value="false"/>
        <arg name="odom_topic"        value="/odom"/>
        <arg name="frame_id"          value="base_link"/>
        <arg name="depth_topic"       value="/depth_left"/>
        <arg name="rgb_topic"         value="/rgb_left"/>
        <arg name="camera_info_topic" value="/camera_info_left"/>
        <arg name="rgbd_sync"         value="true"/>
        <arg name="approx_rgbd_sync"  value="false"/>
        <arg name="use_sim_time"      value="true"/>
    </include>
    
    <node pkg="move_base" type="move_base" respawn="false" name="move_base" output="screen">
        <param name="TrajectoryPlannerROS/max_vel_theta" value="0.3"/>
        <param name="TrajectoryPlannerROS/min_vel_theta" value="-0.3"/>
        <rosparam file="$(find carter_2dnav)/params/costmap_common_params.yaml" command="load" ns="global_costmap" /> 
        <rosparam file="$(find carter_2dnav)/params/costmap_common_params.yaml" command="load" ns="local_costmap" />
        <rosparam file="$(find carter_2dnav)/params/local_costmap_params.yaml" command="load" />
        <rosparam file="$(find carter_2dnav)/params/global_costmap_params.yaml" command="load" /> 
        <rosparam file="$(find carter_2dnav)/params/base_local_planner_params.yaml" command="load" />
    </node>

    <node type="rviz" name="rviz" pkg="rviz" args="-d $(find carter_2dnav)/rviz/carter_2dnav.rviz" />
</launch> 
